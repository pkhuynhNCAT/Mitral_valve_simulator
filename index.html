<!DOCTYPE html>
<html lang="en">
<head>
  <!-- =========================================================
       MITRAL VALVE REPAIR TRAINER — SINGLE-FILE APP (PART 1/✱)
       SECTION: <head> meta + full STYLE system + global SVG defs
       GOAL:
         • Production-grade head metadata (SEO, social, PWA-friendly).
         • Commercial UI design system (tokens, layout grid, component shells).
         • Accessibility, theming, print, motion safety.
         • Visual primitives for: highlights, legends, guides, marked spots.
       NOTE:
         This block is self-contained and does not include <body> or <script>.
  ============================================================ -->

  <!-- ===== META (production-ready) ===== -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Mitral Valve Repair Trainer — Annuloplasty Suturing (Training & Practice)</title>
  <meta name="description" content="Professional, high-fidelity web simulation for mitral valve repair training. Step-by-step suturing guidance with AI Co‑Pilot, annotations, and detailed scoring — single-file app, GitHub Pages-ready." />
  <meta name="keywords" content="mitral valve, surgery training, cardiac surgery, annuloplasty, suturing, simulation, web simulator, education, scoring, AI copilot" />
  <meta name="theme-color" content="#0d1321" />
  <meta name="color-scheme" content="dark light">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="MV Repair Trainer">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 64 64%27%3E%3Cdefs%3E%3ClinearGradient id=%27g%27 x1=%270%25%27 y1=%270%25%27 x2=%27100%25%27 y2=%27100%25%27%3E%3Cstop stop-color=%27%235de4c7%27/%3E%3Cstop stop-color=%27%238bd3ff%27 offset=%271%27/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath fill=%27url(%23g)%27 d=%27M32 58C12 44 4 34 4 22a14 14 0 0 1 26-7 14 14 0 0 1 30 7c0 12-8 22-28 36z%27/%3E%3C/svg%3E" />
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAFElEQVR4Ae3BAQ0AAADCIPunNscCFQAAUzsT2QAAI1iSAAAAAElFTkSuQmCC">
  <link rel="canonical" href="." />

  <!-- OpenGraph / Twitter (social share) -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Mitral Valve Repair Trainer — Annuloplasty Suturing">
  <meta property="og:description" content="Super realistic, professional web simulation for cardiac surgeons. AI-guided steps, clear legends, highlighted targets, marked spots, and a rigorous scoring system.">
  <meta property="og:image" content="data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%221200%22 height=%22630%22%3E%3Crect width=%27100%25%27 height=%27100%25%27 fill=%27%230d1321%27/%3E%3Ctext x=%2750%25%27 y=%2748%25%27 fill=%27%235de4c7%27 font-size=%2750%27 font-family=%27Arial,Helvetica,sans-serif%27 text-anchor=%27middle%27%3EMitral Valve Trainer%3C/text%3E%3Ctext x=%2750%25%27 y=%2766%25%27 fill=%27%238bd3ff%27 font-size=%2728%27 text-anchor=%27middle%27%3EAnnuloplasty Suturing%3C/text%3E%3C/svg%3E">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Mitral Valve Repair Trainer — Annuloplasty Suturing">
  <meta name="twitter:description" content="AI co‑pilot guidance, stepwise suturing, clear highlights/marks, and detailed scoring — in a single-file app.">
  <meta name="twitter:image" content="data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%221200%22 height=%22630%22%3E%3Crect width=%27100%25%27 height=%27100%25%27 fill=%27%230d1321%27/%3E%3Ctext x=%2750%25%27 y=%2748%25%27 fill=%27%235de4c7%27 font-size=%2750%27 font-family=%27Arial,Helvetica,sans-serif%27 text-anchor=%27middle%27%3EMitral Valve Trainer%3C/text%3E%3Ctext x=%2750%25%27 y=%2766%25%27 fill=%27%238bd3ff%27 font-size=%2728%27 text-anchor=%27middle%27%3EAnnuloplasty Suturing%3C/text%3E%3C/svg%3E">

  <!-- ===== Optional CSP (single-file requires 'unsafe-inline'; document first) =====
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' data: blob:; img-src 'self' data: blob:; media-src 'self' data: blob:;
                 style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; connect-src 'self'; font-src 'self' data:;">
  -->

  <!-- =========================================================
       STYLE ARCHITECTURE — PRODUCTION-GRADE DESIGN SYSTEM
       • Dark-first theme, light fallback via [data-theme="light"].
       • Grid shell: topbar / sidebar / viewport / copilot / bottombar.
       • Components for training/practice: legend, guidance, highlights, marks.
       • Motion primitives: halos, ghost dashes, attention pulses.
  ============================================================ -->
  <style>
    /* =========================
       0) CSS RESET & BASELINE
       ========================= */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    html{color-scheme:dark light}
    body{
      margin:0; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      background:radial-gradient(1400px 800px at 60% -10%, #1a2547 0%, #0d1321 60%);
      color:var(--ink-0, #e7ecfb);
      font-family: var(--sans, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial);
      line-height:1.35;
    }
    img,svg,video,canvas{max-width:100%; height:auto}
    :focus{outline:none}
    :focus-visible{outline:2px solid var(--focus, #8bd3ff); outline-offset:.15rem}
    ::selection{background: #234b7d; color:#fff}
    [hidden]{display:none !important}

    /* =========================
       1) DESIGN TOKENS
       ========================= */
    :root{
      /* Color tokens (dark) */
      --bg-0:#0d1321;    /* page */
      --bg-1:#101a34;    /* panels */
      --bg-2:#0f1730;    /* elevated panels */
      --ink-0:#e7ecfb;   /* primary text */
      --ink-1:#a7b5dc;   /* secondary text */
      --ink-dim:#7c89b4;

      --brand:#5de4c7;   /* teal accent: targets, success focus */
      --brand-2:#8bd3ff; /* blue accent: guides, sutures */
      --warn:#ffc857;    /* guidance warnings */
      --danger:#ff5661;  /* errors / tissue violation */
      --ok:#5dd39e;      /* check/ok */
      --muted:#0a1327;   /* deep background */
      --ink-invert:#09222f;

      /* Elevation & radii */
      --shadow-1:0 4px 16px rgba(0,0,0,.35);
      --shadow-2:0 10px 28px rgba(0,0,0,.45);
      --radius-lg:14px; --radius:10px; --radius-sm:8px;

      /* Grid max width */
      --app-mxw:1600px;

      /* Typography */
      --sans: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      --fs-xxs:10px; --fs-xs:12px; --fs-sm:13px; --fs-md:14px; --fs-lg:16px; --fs-xl:18px; --fs-2xl:22px; --fs-3xl:28px;

      /* Motion */
      --dur-1:120ms; --dur-2:220ms; --dur-3:420ms; --dur-4:800ms;
      --eio:cubic-bezier(.22,.61,.36,1);
      --focus:#8bd3ff;

      /* Z-layers */
      --z-topbar:20; --z-overlay:10; --z-hud:15; --z-toast:30; --z-modal:50;
    }
    /* Light theme */
    [data-theme="light"]{
      --bg-0:#f6f8fc; --bg-1:#ffffff; --bg-2:#f1f4fb;
      --ink-0:#0f1730; --ink-1:#3a4a77; --ink-dim:#5b6a96;
      --muted:#e8eefc; --ink-invert:#e7fcf6;
      --focus:#0066cc;
      background:linear-gradient(180deg,#eff3ff,#ffffff);
      color:var(--ink-0);
    }

    /* =========================
       2) TYPOGRAPHY SYSTEM
       ========================= */
    h1,h2,h3,h4,h5,h6{margin:.25rem 0; font-weight:800}
    h1{font-size:var(--fs-xl)}
    h2{font-size:var(--fs-lg)}
    h3{font-size:var(--fs-md)}
    p{margin:.5rem 0}
    small,.meta{color:var(--ink-1); font-size:var(--fs-xs)}
    code,kbd,samp{font-family:var(--mono); font-size: .95em}

    /* =========================
       3) LAYOUT GRID
       ========================= */
    .app{
      display:grid;
      grid-template-rows: 64px 1fr 44px;
      grid-template-columns: 300px minmax(720px,1fr) 420px;
      grid-template-areas:
        "topbar topbar topbar"
        "sidebar viewport copilot"
        "bottombar bottombar bottombar";
      height:100%;
      margin:0 auto; max-width:var(--app-mxw);
    }
    header.topbar{grid-area:topbar}
    aside.sidebar{grid-area:sidebar}
    main.viewport{grid-area:viewport}
    aside.copilot{grid-area:copilot}
    footer.bottombar{grid-area:bottombar}

    /* Responsive breakpoints */
    @media (max-width: 1440px){
      .app{ grid-template-columns: 260px 1fr 380px; }
    }
    @media (max-width: 1200px){
      .app{ grid-template-columns: 1fr; grid-template-rows: 64px auto auto 44px;
            grid-template-areas:
              "topbar" "viewport" "copilot" "bottombar"; }
      aside.sidebar{display:none}
    }
    @media (max-width: 640px){
      .app{ grid-template-rows: 56px auto auto 40px; }
    }

    /* =========================
       4) COMPONENT SHELLS
       (Visuals tuned for commercial polish but logic added later)
       ========================= */

    /* Top bar */
    header.topbar{
      display:flex; align-items:center; gap:16px;
      padding:10px 14px;
      background:linear-gradient(180deg, rgba(17,24,43,.85), rgba(17,24,43,.6));
      border-bottom:1px solid #223055; box-shadow:var(--shadow-1);
      position:relative; z-index:var(--z-topbar);
      backdrop-filter: blur(8px) saturate(1.1);
    }
    .title{display:flex; align-items:center; gap:12px; min-width:240px}
    .title .mark{
      width:38px; height:38px; border-radius:10px;
      background:conic-gradient(from 90deg, var(--brand-2), var(--brand), var(--brand-2));
      box-shadow: inset 0 0 18px #0008, 0 2px 8px #000a;
      position:relative;
    }
    .title .mark::after{
      content:"MV"; position:absolute; inset:0; display:grid; place-items:center;
      font-weight:900; color:var(--ink-invert); letter-spacing:.3px;
      text-shadow:0 1px 0 #ffffff22;
    }
    .title h1{font-size:var(--fs-xl); margin:0}
    .title .subtitle{font-size:var(--fs-xs); color:var(--ink-1); margin-top:-2px}

    /* Segmented control (Training | Practice) */
    .segmented{
      display:inline-flex; padding:2px; border-radius:12px;
      background: #0e1a33; border:1px solid #223055; box-shadow:var(--shadow-1);
    }
    .segmented input{display:none}
    .segmented label{
      padding:6px 10px; font-size:var(--fs-xs); color:var(--ink-1);
      cursor:pointer; border-radius:8px; min-width:120px; text-align:center; user-select:none;
    }
    .segmented input:checked + label{
      color:#041c16; font-weight:800;
      background:linear-gradient(180deg, #3bd2b6, #3abfc1);
      box-shadow:inset 0 -1px 0 #0005, 0 1px 2px #0008;
    }

    .topbar-actions{margin-left:auto; display:flex; align-items:center; gap:8px}

    /* Buttons */
    .btn{
      appearance:none; border:1px solid #27406a; background:linear-gradient(180deg,#1a2646,#131c34);
      color:var(--ink-0); padding:8px 12px; border-radius:10px; font-weight:700; letter-spacing:.2px; cursor:pointer;
      box-shadow:inset 0 0 0 1px #0008, var(--shadow-1);
      transition:transform var(--dur-1) var(--eio), filter var(--dur-1) var(--eio);
    }
    .btn:hover{filter:brightness(1.08)}
    .btn:active{transform:translateY(1px)}
    .btn.ghost{background:transparent}
    .btn.brand{border-color:#197e6e; background:linear-gradient(180deg,#0f423b,#0c302b)}
    .btn.warn{border-color:#8a5a11; background:linear-gradient(180deg,#4d3612,#3a2a10)}

    /* Sidebar cards */
    aside.sidebar{
      padding:10px; overflow:auto; background:linear-gradient(180deg,#0f1730,#0d1426);
      border-right:1px solid #223055;
    }
    .card{
      background:linear-gradient(180deg,#121c38,#0f1832);
      border:1px solid #1f2c52; border-radius:var(--radius-lg); padding:12px; margin-bottom:10px; box-shadow:var(--shadow-1);
    }
    .card h3{margin:.2em 0 .6em 0; font-size:var(--fs-md); letter-spacing:.3px}
    .kv{display:grid; grid-template-columns: 1fr auto; gap:6px; font-size:var(--fs-xs)}
    .kv div:nth-child(odd){color:var(--ink-1)}
    .badge{display:inline-block; padding:3px 8px; border-radius:999px; background:#132145; border:1px solid #2a3d67; font-size:var(--fs-xxs); color:#9ec2ff}

    /* Legend (explicit color+shape coding for step shadowing) */
    .legend{display:grid; gap:6px; font-size:var(--fs-xs)}
    .legend .item{display:flex; align-items:center; gap:8px}
    .legend .swatch{width:12px; height:12px; border-radius:50%; box-shadow:0 0 0 3px #0006}
    .swatch.teal{background:var(--brand)}
    .swatch.blue{background:var(--brand-2)}
    .swatch.gold{background:var(--warn)}
    .swatch.red{background:var(--danger)}

    /* Viewport shell */
    main.viewport{
      position:relative; overflow:hidden;
      background:
        radial-gradient(900px 500px at 50% -100px, #1b2b52, transparent 50%),
        radial-gradient(900px 500px at 50% 120%, #0a1122, transparent 50%),
        var(--muted);
      border-left:1px solid #20325a; border-right:1px solid #20325a;
    }
    #render3d{
      position:absolute; inset:0; width:100%; height:100%; display:block; cursor: crosshair;
      filter: drop-shadow(0 30px 60px #0009);
    }
    #overlay{
      position:absolute; inset:0; width:100%; height:100%;
      pointer-events:none; /* interaction via controller in script */
      z-index:var(--z-overlay);
    }

    /* Overlay visual primitives — Matches training/practice requirements */
    /* Targets (“mark the spots”) */
    #overlay .target { /* <g class="target"> */
      --halo-r:16px;
      animation: halo-breathe var(--dur-4) ease-in-out infinite;
    }
    #overlay .target circle.core{ fill:var(--brand); stroke:#022; stroke-width:1.2; }
    #overlay .target circle.halo{ fill:url(#halo-brand); }
    #overlay .target text.label{
      fill:var(--brand-2); font-weight:900; font-size:10px; text-shadow:0 1px 0 #000;
    }

    /* Guides (arcs/arrows) */
    #overlay .guide{ stroke:var(--brand-2); stroke-width:3; fill:none; marker-end:url(#arrow); filter:url(#soft-glow); }
    #overlay .guide--ghost{ stroke:var(--warn); stroke-dasharray:5 5; animation: dashflow 1.8s linear infinite; }

    /* Sutures */
    #overlay .suture-ok{ stroke:var(--brand-2); stroke-width:3; fill:none; filter:url(#soft-glow) }
    #overlay .suture-bad{ stroke:var(--danger); stroke-width:3.5; fill:none; filter:url(#soft-glow) }

    /* Warnings (leaflet/chordae violations) */
    #overlay .warn circle{ fill:url(#halo-warn) }
    #overlay .warn text{ fill:#2b1f00; font-weight:900; font-size:11px; text-anchor:middle }

    /* HUD tiles */
    .hud{
      position:absolute; left:12px; bottom:12px; right:12px;
      display:flex; gap:12px; justify-content:space-between; pointer-events:none; z-index:var(--z-hud);
    }
    .hud .cluster{ display:flex; gap:10px; align-items:flex-end; }
    .tile{
      pointer-events:auto; padding:8px 12px; border-radius:12px;
      background:linear-gradient(180deg,#111c38,#0e172e);
      border:1px solid #20345f; box-shadow:var(--shadow-1); font-size:var(--fs-xs);
      min-width:90px;
    }
    .tile strong{display:block; font-size:var(--fs-2xl); line-height:1.1}

    /* Right panel: tabs/panels, chat, checklist, metrics, logs */
    aside.copilot{
      display:flex; flex-direction:column; background:linear-gradient(180deg,#121a33,#0f1526);
      border-left:1px solid #223055;
    }
    .tabs{display:flex; gap:6px; padding:10px; border-bottom:1px solid #223055}
    .tab{
      padding:8px 10px; font-size:var(--fs-xs); border-radius:10px; cursor:pointer; border:1px solid transparent; color:var(--ink-1);
      user-select:none; transition:filter var(--dur-1) var(--eio);
    }
    .tab:hover{filter:brightness(1.08)}
    .tab.active{color:#041a15; font-weight:800; background:linear-gradient(180deg,#3bd2b6,#3bc3c2); box-shadow:var(--shadow-1)}
    .panel{flex:1; overflow:auto; padding:12px; display:none}
    .panel.active{display:block}

    .chat{display:flex; flex-direction:column; gap:10px}
    .msg{
      display:grid; grid-template-columns:auto 1fr; gap:10px; align-items:flex-start;
      background:linear-gradient(180deg,#0f1a32,#0c1529); border:1px solid #223055; border-radius:14px; padding:10px;
    }
    .msg .role{font-size:var(--fs-xxs); text-transform:uppercase; letter-spacing:.5px; color:var(--ink-1)}
    .msg .text{font-size:var(--fs-sm)}
    .msg.coach{border-color:#226e62; box-shadow:0 0 0 2px #1a3f3a inset}
    .msg.user{border-color:#334a7a; box-shadow:0 0 0 2px #263553 inset}
    .checkpoint{padding:8px 10px; border-left:3px solid var(--brand); background:#0c1a2b; border-radius:10px; font-size:var(--fs-xs)}

    .checklist{display:grid; gap:8px}
    .check{display:flex; gap:8px; align-items:flex-start; background:#0f1830; border:1px solid #223055; border-radius:10px; padding:8px}
    .check input{accent-color:var(--brand)}

    .scorebox{display:grid; grid-template-columns:repeat(2,1fr); gap:10px}
    @media (min-width: 1440px){ .scorebox{grid-template-columns:repeat(4,1fr)} }
    .metric{background:#0f1830; border:1px solid #223055; border-radius:12px; padding:8px}
    .metric .label{font-size:var(--fs-xxs); color:var(--ink-1)}
    .metric .val{font-size:var(--fs-2xl); font-weight:900}

    .log{font-family:var(--mono); font-size:var(--fs-xs); background:#0b1224; border:1px solid #1e2a4d; border-radius:10px; padding:8px; white-space:pre-wrap}

    /* Bottom bar */
    footer.bottombar{
      display:flex; align-items:center; gap:10px; padding:6px 10px;
      background:linear-gradient(180deg, rgba(16,25,44,.9), rgba(12,19,34,.9)); border-top:1px solid #223055;
    }
    .kbd{font-family:var(--mono); font-size:var(--fs-xxs); background:#0a162b; border:1px solid #20345f; padding:3px 6px; border-radius:6px}
    .hint{color:var(--ink-1); font-size:var(--fs-xs)}

    /* =========================
       5) ACCESSIBILITY & FOCUS
       ========================= */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    @media (prefers-reduced-motion: reduce){
      *{animation-duration:.001ms !important; animation-iteration-count:1 !important; transition-duration:.001ms !important; scroll-behavior:auto !important}
    }
    @media (prefers-contrast: more){
      :root{--focus:#00b7ff}
      .btn,.card,.tile,.metric,.msg{border-width:2px}
    }
    @media (forced-colors: active){
      .tab.active{background:Highlight; color:HighlightText}
    }

    /* =========================
       6) THEMING HOOKS & PRINT
       ========================= */
    @media print{
      body{background:#fff; color:#000}
      .app{max-width:100%; grid-template-columns:1fr; grid-template-areas:"topbar" "viewport" "scores"; grid-template-rows:auto auto auto}
      aside.sidebar, aside.copilot, footer.bottombar{display:none}
      main.viewport{border:none}
    }

    /* =========================
       7) MOTION PRIMITIVES (highlights/ghost)
       ========================= */
    @keyframes halo-breathe{
      0%,100%{ opacity:.85; transform:scale(1) }
      50%{ opacity:.55; transform:scale(1.06) }
    }
    @keyframes dashflow{
      to{ stroke-dashoffset:-1000 }
    }
  </style>

  <!-- =========================================================
       GLOBAL SVG DEFINITIONS (for highlights, arrows, glows, clips)
       These defs power “highlight area”, “mark the spots”, guides, etc.
  ============================================================ -->
  <svg width="0" height="0" class="sr-only" aria-hidden="true" focusable="false">
    <defs>
      <!-- Highlight halos -->
      <radialGradient id="halo-brand" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#5de4c7" stop-opacity="0.95"/>
        <stop offset="55%" stop-color="#5de4c7" stop-opacity="0.42"/>
        <stop offset="100%" stop-color="#5de4c7" stop-opacity="0"/>
      </radialGradient>
      <radialGradient id="halo-warn" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#ffc857" stop-opacity="0.95"/>
        <stop offset="55%" stop-color="#ffc857" stop-opacity="0.42"/>
        <stop offset="100%" stop-color="#ffc857" stop-opacity="0"/>
      </radialGradient>

      <!-- Guidance arrowheads -->
      <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="6" markerHeight="6" orient="auto">
        <path d="M 0 0 L 10 5 L 0 10 z" fill="#8bd3ff"/>
      </marker>

      <!-- Soft glow for sutures/guides (subtle realism) -->
      <filter id="soft-glow" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur stdDeviation="2" result="blur"/>
        <feMerge>
          <feMergeNode in="blur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>

      <!-- Optional viewport clip (ellipse) to contain overlays -->
      <clipPath id="viewport-clip">
        <!-- Path supplied later when geometry is known -->
        <rect x="0" y="0" width="100%" height="100%"></rect>
      </clipPath>
    </defs>
  </svg>
</head>
